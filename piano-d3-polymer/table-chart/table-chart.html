<polymer-element name="table-chart" attributes="dataFile, headerFields, inlineChartFields, intFields, percentFields, intPercentFields">
    <template>
        <link rel="stylesheet" type="text/css" href="table-chart.css">
        <svg id="svg"></svg>
    </template>
    <script>
        Polymer({
            createElements: function () {
              this.chartWidth = "175px";
              this.percent = d3.format(".2%");


              this.table = d3.select("body").append("table");



            },
            drawChart: function () {

              var me = this;

              me.data = [
                ["Credit", - 0.040],
                ["Relative Value", - 0.008],
                ["Multi-Strategy", - 0.030],
                ["Event Driven", - 0.004],
                ["Equities",- 0.047],
                ["Macro", - 0.02],
                ["Commodities", - 0.001],
                ["Portfolio Hedges", - 0.004],
                ["Other", - 0.002],
                ["Total", - 0.156]
              ];

              me.data.sort(function(a, b) {return d3.descending(a[1], b[1])});

              me.x = d3.scale.linear()
                  .domain([0, d3.max(me.data, function(d) { return Math.abs(d[1]); })])
                  .range(["0%", "100%"]);


              // Create a table with rows and bind a data row to each table row
              me.tr = me.table.selectAll("tr.data")
                .data(me.data)
                .enter()
                .append("tr")
                .attr("class", "datarow");

              d3.selection.prototype.last = function() {
                var last = this[0].length - 1;
                var b = d3.select(this[0][last])
                return b;
              };


              // Set the even columns
              me.tr.last().attr("class", "datarow head");


              // Create the name column
              me.tr.append("td").attr("class", "data name")
                  .text(function(d) { return d[0] });

              // Create the percent value column
              me.tr.append("td").attr("class", "data value")
                  .text(function(d) { return me.percent(d[1]) })

              // Create a column at the beginning of the table for the chart
              me.chart = me.tr.append("td").attr("class", "chart").attr("width", me.chartWidth);

              // Create the div structure of the chart
              me.chart.append("div").attr("class", "container").append("div").attr("class", "negative");

        //       Creates the negative div bar
              me.tr.select("div.negative")
                .style("width", "0%")
                .transition()
                .duration(500)
                .style("width", function(d) { return d[1] > 0 ? "0%" : me.x(Math.abs(d[1]));});

            },

            getData: function () {
              var me = this;
              d3.json(me.dataFile, function(error, rawData) {
                    me.data = rawData;
                    me.drawChart();
              })

            },
            domReady: function () {
              this.createElements();
              this.getData();
            }
        });
    </script>
</polymer-element>